@if (open) {
<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm transition-opacity"
    data-backdrop="true" (click)="onBackdropClick($event)">

    <div class="bg-white dark:bg-[#1a140f] rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto flex flex-col border border-[#e6e0db] dark:border-white/10"
        role="dialog" aria-modal="true">

        <!-- Header -->
        <div
            class="px-6 py-4 border-b border-[#e6e0db] dark:border-white/10 flex items-center justify-between sticky top-0 bg-white dark:bg-[#1a140f] z-10">
            <h2 class="text-xl font-bold text-[#181411] dark:text-white">
                {{ isEdit ? 'Editar Categoría' : 'Nueva Categoría' }}
            </h2>
            <button type="button" (click)="onClose()"
                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <!-- Body -->
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="p-6 flex flex-col gap-6">

            <!-- Name -->
            <div class="flex flex-col gap-1">
                <label class="text-sm font-semibold text-[#181411] dark:text-white">Nombre</label>
                <input formControlName="name" type="text"
                    class="form-input w-full px-3 py-2 rounded-lg border border-[#e6e0db] dark:border-white/10 bg-white dark:bg-black/20 text-[#181411] dark:text-white focus:border-[#f27f0d] focus:ring-1 focus:ring-[#f27f0d] outline-none transition-all placeholder:text-gray-400"
                    placeholder="Nombre de la categoría" />
                @if(hasError('name', 'required')) { <span class="text-xs text-red-500">Requerido</span> }
                @if(hasError('name', 'minlength')) { <span class="text-xs text-red-500">Mínimo 2 letras</span> }
            </div>

            <!-- Icon -->
            <div class="flex flex-col gap-1">
                <label class="text-sm font-semibold text-[#181411] dark:text-white">Icono (Material Symbol)</label>
                <input formControlName="icon" type="text"
                    class="form-input w-full px-3 py-2 rounded-lg border border-[#e6e0db] dark:border-white/10 bg-white dark:bg-black/20 text-[#181411] dark:text-white focus:border-[#f27f0d] focus:ring-1 focus:ring-[#f27f0d] outline-none transition-all placeholder:text-gray-400"
                    placeholder="spa, wheelchair_pickup, category..." />
                <p class="text-xs text-gray-400">Nombre del icono de Material Symbols (ej: spa, medical_services)</p>
            </div>

            <!-- Description -->
            <div class="flex flex-col gap-1">
                <label class="text-sm font-semibold text-[#181411] dark:text-white">Descripción</label>
                <textarea formControlName="description" rows="3"
                    class="form-textarea w-full px-3 py-2 rounded-lg border border-[#e6e0db] dark:border-white/10 bg-white dark:bg-black/20 text-[#181411] dark:text-white focus:border-[#f27f0d] focus:ring-1 focus:ring-[#f27f0d] outline-none transition-all resize-none placeholder:text-gray-400"
                    placeholder="Detalles opcionales..."></textarea>
            </div>

        </form>

        <!-- Footer -->
        <div
            class="px-6 py-4 border-t border-[#e6e0db] dark:border-white/10 flex items-center justify-end gap-3 bg-gray-50 dark:bg-black/20 rounded-b-xl">
            <button type="button" (click)="onClose()"
                class="px-4 py-2 hover:cursor-pointer rounded-lg text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-black/5 dark:hover:bg-white/5 transition-colors"
                [disabled]="saving">
                Cancelar
            </button>
            <button type="button" (click)="onSubmit()"
                class="px-4 py-2 hover:cursor-pointer rounded-lg text-sm font-bold text-white bg-[#f27f0d] hover:bg-[#f27f0d]/90 shadow-lg shadow-[#f27f0d]/20 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="saving || form.invalid">
                @if(saving) {
                <span class="material-symbols-outlined animate-spin text-sm">progress_activity</span>
                Guardando...
                } @else {
                Guardar
                }
            </button>
        </div>

    </div>
</div>
}